(()=>{"use strict";var t={d:(e,n)=>{for(var r in n)t.o(n,r)&&!t.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:n[r]})},o:(t,e)=>Object.prototype.hasOwnProperty.call(t,e),r:t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})}},e={};t.r(e),t.d(e,{c2AnimatedBg:()=>j,cAnimation:()=>I,cInput:()=>k,cInputRunner:()=>A,cPlayer:()=>T,cPosition:()=>b,cShape:()=>P,cSprite:()=>S,cVelocity:()=>x});var n,r,o=(n=function(t,e){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},n(t,e)},function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function r(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}),i=function(){function t(t,e){this.width=t,this.height=e,this.data=new Uint32Array(t*e)}return t.from=function(e,n,r){var o=new t(n,r);return o.data=new Uint32Array(e),o},Object.defineProperty(t.prototype,"pixels",{get:function(){return this.data},enumerable:!1,configurable:!0}),t.prototype.draw=function(t,e,n){for(var r=this,o=r.data,i=r.width,a=r.height,s=t.data,c=t.width,u=s.length;u--;)if(0!==s[u]){var l=e+u%c,f=n+(u/c|0);l<0||l>=i||f<0||f>=a||(o[l+f*i]=s[u])}return this},t.prototype.copy=function(t,e,n,r,o,i,a){for(var s=t.data,c=t.width,u=t.height,l=this.data,f=this.width,h=i*a;h--;){var p=r+h%i+(o+(h/i|0))*f;if(0!=l[p]){var d=e+h%i,g=n+(h/i|0);d<0||d>=c||g<0||g>=u||(s[d+g*c]=l[p])}}return this},t.prototype.extract=function(e,n,r,o){for(var i=new t(r,o),a=this,s=a.data,c=a.width,u=a.height,l=i.data,f=i.width,h=l.length;h--;){var p=e+h%f,d=n+(h/f|0);p<0||p>=c||d<0||d>=u||(l[h]=s[p+d*c])}return i},t.prototype.clone=function(){for(var e=new t(this.width,this.height),n=e.data,r=this.data,o=n.length;o--;)n[o]=r[o];return e},t.prototype.fill=function(t){return this.data.fill(t),this},t.prototype.flipV=function(){for(var t=this.data,e=this.width,n=t.length;n--;){var r=e-n%e-1;if(!(r>=e/2)){var o=r+(n/e|0)*e,i=t[n];t[n]=t[o],t[o]=i}}return this},t.prototype.flipH=function(){for(var t=this,e=t.data,n=t.width,r=t.height,o=e.length/2;o--;){var i=o%n+(r-(o/n|0)-1)*n,a=e[o];e[o]=e[i],e[i]=a}return this},t}(),a=function(t){function e(e,n,r,o){var i=t.call(this,e*r,n*o)||this;return i.twidth=e,i.theight=n,i.cols=r,i.rows=o,i}return o(e,t),e.from=function(t,n,r,o,i){void 0===o&&(o=1),void 0===i&&(i=1);var a=new e(n,r,o,i);return a.data=new Uint32Array(t),a},e.prototype.extractTile=function(t,e){return this.extract(t*this.twidth,e*this.theight,this.twidth,this.theight)},e.prototype.copyTile=function(t,e,n,r,o){return this.copy(t,e,n,r*this.twidth,o*this.theight,this.twidth,this.theight)},e.prototype.split=function(){for(var t=[],e=0;e<this.rows;e++)for(var n=0;n<this.cols;n++){var r=n*this.twidth,o=e*this.theight;t.push(this.extract(r,o,this.twidth,this.twidth))}return t},e.prototype.reorder=function(t,n,r){for(var o=this,i=o.twidth,a=o.theight,s=o.cols,c=new e(i,a,n,r),u=n*r;u--;){var l=t[u],f=[u%n,u/n|0],h=f[0],p=f[1],d=[l%s,l/s|0],g=d[0],y=d[1];this.copyTile(c,h*i,p*a,g,y)}return c},e}(i),s=function(){function t(t){this.bitmap=t;for(var e=t.pixels,n=[],r=[],o=e.length;o--;){var i=e[o],a=r.indexOf(i);a<0?(n[o]=r.length,r.push(i)):n[o]=a}this.palleteMap=new Uint8Array(n),this.palleteData=new Uint32Array(r)}return Object.defineProperty(t.prototype,"colors",{get:function(){return Array.from(this.palleteData)},set:function(t){var e=this.palleteData.length;this.palleteData.set(t.slice(0,e)),this.remap()},enumerable:!1,configurable:!0}),t.prototype.remap=function(){for(var t=this,e=t.bitmap.pixels,n=t.palleteData,r=t.palleteMap,o=e.length;o--;)e[o]=n[r[o]]},t}(),c={loadImage:function(t){return new Promise((function(e,n){var r=new Image;r.onload=function(){var t=document.createElement("canvas"),n=t.getContext("2d"),o=r.width,i=r.height;t.width=o,t.height=i,n.drawImage(r,0,0);var a=n.getImageData(0,0,o,i);return e({width:o,height:i,data:a.data.buffer})},r.onerror=function(t){console.error("Error loading image:",t),n(t)},r.src=t}))},loadImageAsBitmap:function(t){return c.loadImage(t).then((function(t){return i.from(t.data,t.width,t.height)})).catch((function(e){throw console.error("Error loading bitmap:",t),e}))},loadImagesAsTileableBitmaps:function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return Promise.all(t.map((function(t){var e=t[0],n=t[1],r=t[2],o=t[3],i=t[4];return c.loadImage(e).then((function(t){return a.from(t.data,n,r,o,i)})).catch((function(t){return console.error("Error loading tileable bitmap:",e,t),a.from(new ArrayBuffer(n*r),n,r,o,i)}))})))}},u={hex2abgr:function(t){return[t>>>24&255,t>>>16&255,t>>>8&255,255&t]},abgr2hex:function(t){return(t[0]<<24|t[1]<<16|t[2]<<8|t[3])>>>0},hexadjust:function(t,e){var n=e[0],r=e[1],o=e[2],i=e[3],a=u.hex2abgr(t),s=a[0],c=a[1],l=a[2],f=a[3];return u.abgr2hex([Math.min(s*n,255),Math.min(c*r,255),Math.min(l*o,255),Math.min(f*i,255)])},calccoefs:function(t,e,n){return void 0===n&&(n=1),[0==t[0]?255:e[0]/t[0]*n,0==t[1]?255:e[1]/t[1]*n,0==t[2]?255:e[2]/t[2]*n,0==t[3]?255:e[3]/t[3]*n]},interpolate:function(t,e,n){var r=u.hex2abgr(t),o=u.hex2abgr(e),i=r[0]+(o[0]-r[0])*n|0,a=r[1]+(o[1]-r[1])*n|0,s=r[2]+(o[2]-r[2])*n|0,c=r[3]+(o[3]-r[3])*n|0;return u.abgr2hex([i,a,s,c])}},l=function(){return performance.now()};!function(t){t.None="none",t.Left="left",t.Right="right",t.Top="top",t.Bottom="bottom"}(r||(r={}));var f=function(){var t=function(e,n){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},t(e,n)};return function(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),h=function(t,e,n,r){return new(n||(n=Promise))((function(o,i){function a(t){try{c(r.next(t))}catch(t){i(t)}}function s(t){try{c(r.throw(t))}catch(t){i(t)}}function c(t){var e;t.done?o(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(a,s)}c((r=r.apply(t,e||[])).next())}))},p=function(t,e){var n,r,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(s){return function(c){return function(s){if(n)throw new TypeError("Generator is already executing.");for(;i&&(i=0,s[0]&&(a=0)),a;)try{if(n=1,r&&(o=2&s[0]?r.return:s[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,s[1])).done)return o;switch(r=0,o&&(s=[2&s[0],o.value]),s[0]){case 0:case 1:o=s;break;case 4:return a.label++,{value:s[1],done:!1};case 5:a.label++,r=s[1],s=[0];continue;case 7:s=a.ops.pop(),a.trys.pop();continue;default:if(!((o=(o=a.trys).length>0&&o[o.length-1])||6!==s[0]&&2!==s[0])){a=0;continue}if(3===s[0]&&(!o||s[1]>o[0]&&s[1]<o[3])){a.label=s[1];break}if(6===s[0]&&a.label<o[1]){a.label=o[1],o=s;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(s);break}o[2]&&a.ops.pop(),a.trys.pop();continue}s=e.call(t,a)}catch(t){s=[6,t],r=0}finally{n=o=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,c])}}},d=function(){function t(t,e,n,r){void 0===r&&(r=.05),this.rate=t,this.update=e,this.render=n,this.deltaCoef=r,this.timestamp=0,this.running=!1}return t.prototype.start=function(){this.running||(this.running=!0,this.tick())},t.prototype.stop=function(){this.running=!1},t.prototype.isRunning=function(){return this.running},t.prototype.getTimestamp=function(){return this.timestamp},t.prototype.tick=function(){return h(this,void 0,void 0,(function(){var t,e,n;return p(this,(function(r){switch(r.label){case 0:return this.running?(t=l(),e=(t-this.timestamp)*this.deltaCoef,n=t*this.deltaCoef,this.timestamp=t,[4,(o=this.rate,new Promise((function(t){return setTimeout(t,o)})))]):[3,2];case 1:return r.sent(),this.update(e,n),this.render(e,n),[3,0];case 2:return[2]}var o}))}))},t}(),g=(function(t){function e(){return null!==t&&t.apply(this,arguments)||this}f(e,t),e.prototype.tick=function(){return h(this,void 0,void 0,(function(){var t,e,n,r=this;return p(this,(function(o){return this.running?(t=l(),e=(t-this.timestamp)*this.deltaCoef,n=t*this.deltaCoef,this.timestamp=t,setTimeout((function(){return r.tick()}),this.rate),this.update(e,n),this.render(e,n),[2]):[2]}))}))}}(d),function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return f(e,t),e.prototype.tick=function(){return h(this,void 0,void 0,(function(){var t,e=this;return p(this,(function(n){return this.running?((t=function(n){var r=(n-e.timestamp)*e.deltaCoef,o=n*e.deltaCoef;e.timestamp=n,e.update(r,o),e.render(r,o),window.requestAnimationFrame(t)})(l()),[2]):[2]}))}))},e}(d)),y=function(){return y=Object.assign||function(t){for(var e,n=1,r=arguments.length;n<r;n++)for(var o in e=arguments[n])Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o]);return t},y.apply(this,arguments)},v=function(){function t(t){this.components=t,this.idx=0}return t.prototype.add=function(t){for(var e=0,n=Object.entries(t);e<n.length;e++){var r=n[e],o=r[0],i=r[1];this.components[o].set(this.idx,i)}return this.idx++},t.prototype.set=function(t,e){for(var n=0,r=Object.entries(this.components);n<r.length;n++){var o=r[n],i=o[0];o[1].set(t,(null==e?void 0:e[i])||{})}return t},t.prototype.get=function(t){for(var e={},n=0,r=Object.entries(this.components);n<r.length;n++){var o=r[n],i=o[0],a=o[1];e[i]=a.get(t)}return e},t.prototype.reset=function(){for(var t=0,e=Object.values(this.components);t<e.length;t++)e[t].reset();this.idx=0},t}(),w=function(){function t(t){this.schema=t,this.storage=Object.keys(t).reduce((function(t,e){var n;return y(y({},t),((n={})[e]=[],n))}),{})}return t.prototype.get=function(t){var e=this.storage,n={};for(var r in e)n[r]=e[r][t];return n},t.prototype.set=function(t,e){var n=this.storage;for(var r in n)n[r][t]=e[r]||this.schema[r];return t},t.prototype.reset=function(){var t=this.storage;for(var e in t)t[e].length=0},t}(),m=function(){function t(t,e){this.components=t,this.handler=e}return t.prototype.setup=function(){for(var t=this,e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];return function(n){return t.handler.apply(t,function(t,e,n){if(n||2===arguments.length)for(var r,o=0,i=e.length;o<i;o++)!r&&o in e||(r||(r=Array.prototype.slice.call(e,0,o)),r[o]=e[o]);return t.concat(r||Array.prototype.slice.call(e))}([n,t.components],e,!1))}},t}();console.debug("COMPONENTS: definitions");var b=new w({x:0,y:0}),x=new w({vx:0,vy:0}),P=new w({w:0,h:0}),S=new w({spriteIdx:0,sprites:[],flipped:!1,offsetX:0,offsetY:0}),I=new w({animations:[[]],current:0,length:0,time:0,coef:0}),k=new w({keys:new Set}),A=new w({actions:new Set,jumping:!1,acceleration:0}),T=new w({air:!1,speed:0,power:0}),j=new w({}),E=function(t,e,n,o,i,a,s,c){return t>s||i>n||e>c||a>o?r.None:Math.min(n-i,s-t)<Math.min(o-a,c-e)?t>i?r.Left:r.Right:e>a?r.Top:r.Bottom},O=function(t,e,n,o,i,a,s,c){return e<a?r.Top:o>c?r.Bottom:t<i?r.Left:n>s?r.Right:r.None},C=function(t){var e=t.width,n=t.height,r=t.gravity,o=t.friction,i=t.skyColor;this.width=e,this.height=n,this.gravity=r,this.friction=o,this.skyColor=i,this.time=0},B=function(){function t(t,e,n,r){var o=e.bgfill,i=e.fgfill,a=e.bgwidth,c=e.bgrows,u=e.length;this.world=t,this.config=e,this.bgFill=o,this.fgFill=i,this.width=a*n.twidth,this.progress=u,this.handlers={onstart:function(){},onfinish:function(){}},this.bgRows=[];for(var l=0;l<c.length;l++){var f=c[l],h=f.layout,p=f.colors,d=f.offset,g=f.speed,y=n.reorder(h.concat(h),2*a,1),v=new s(y);v.colors=p,this.bgRows[l]={sprite:y,pallete:v,speed:.5*g,shift:0,offset:d*y.theight}}}return t.prototype.update=function(t){var e=this;if(this.progress-=t,this.progress<=100&&!this.bgFadeoutTimer&&(this.bgFadeoutTimer=setInterval((function(){return e.interpolateBgPallete((100-e.progress)/100)}),100)),this.progress<=0)return this.finish(),void this.next.start()},t.prototype.renderBg=function(t,e){var n=this,r=n.width,o=n.bgRows,i=n.bgFill;e.fill(i);for(var a=0,s=o;a<s.length;a++){var c=s[a];c.shift-=c.speed*t,-r>=c.shift&&(c.shift=0),e.draw(c.sprite,Math.round(c.shift),c.offset)}},t.prototype.renderFg=function(t,e){},t.prototype.interpolateBgPallete=function(t){if(this.next){var e=this.config,n=e.bgrows,r=e.bgfill,o=this.next.config,i=o.bgrows,a=o.bgfill;this.bgFill=u.interpolate(r,a,t),this.bgRows.forEach((function(e,r){var o=n[r].colors,a=i[r].colors,s=o.map((function(e,n){return u.interpolate(o[n],a[n],t)}));e.pallete.colors=s}))}},t.prototype.setNext=function(t){this.next=t;var e=u.calccoefs(u.hex2abgr(this.config.bgfill),u.hex2abgr(t.config.bgfill)),n=(e[0],e[1]),r=e[2],o=e[3];this.bgFadeoutCoefs=[n,r,o]},t.prototype.start=function(){this.handlers.onstart(this,this.next),clearInterval(this.bgFadeoutTimer),console.debug("Start: ".concat(this.config.name))},t.prototype.finish=function(){this.handlers.onfinish(this,this.next),clearInterval(this.bgFadeoutTimer),console.debug("Finish: ".concat(this.config.name))},t.prototype.onstart=function(t){this.handlers.onstart=t},t.prototype.onfinish=function(t){this.handlers.onfinish=t},t}();const R=[{name:"MorningCity",bgwidth:10,length:2e3,bgfill:4294298229,fgfill:4278198784,bgrows:[{layout:[0,0,0,0,0,0,0,0,0,0],offset:.5,speed:1,colors:[0,4293241413,4293576560]},{layout:[0,0,0,0,0,0,0,0,0,0],offset:0,speed:2,colors:[0,4292188757,4290083381]},{layout:[2,2,2,2,2,2,2,2,2,2],offset:2.5,speed:2,colors:[4283786786,0,0]},{layout:[2,2,2,2,2,2,2,2,2,2],offset:3,speed:3,colors:[4282668322,0,0]},{layout:[3,3,3,3,3,3,3,3,3,3],offset:3.5,speed:3.5,colors:[4281545006,0,0]},{layout:[5,5,5,5,5,5,5,5,5,5],offset:4,speed:4,colors:[4280426784,4281348144,0]}]},{name:"SunsetCity",bgwidth:10,length:3e3,bgfill:4282685949,fgfill:4280295714,bgrows:[{layout:[0,0,0,0,0,0,0,0,0,0],offset:.5,speed:1,colors:[0,4281558766,4280435882]},{layout:[0,0,0,0,0,0,0,0,0,0],offset:0,speed:2,colors:[0,4279317384,4280440251]},{layout:[2,2,2,2,2,2,2,2,2,2],offset:2.5,speed:2,colors:[4282401355,0,0]},{layout:[5,5,5,5,5,5,5,5,5,5],offset:3,speed:3,colors:[4281348662,4280311952,0]},{layout:[5,5,5,5,5,5,5,5,5,5],offset:3.5,speed:3.5,colors:[4280822059,4280311952,0]},{layout:[5,5,5,5,5,5,5,5,5,5],offset:4,speed:4,colors:[4280295714,4280311952,0]}]},{name:"NightCity",bgwidth:10,length:5e3,bgfill:4281736480,fgfill:4281015067,bgrows:[{layout:[0,0,0,0,0,0,0,0,0,0],offset:.5,speed:1,colors:[0,4282392614,4285152847]},{layout:[0,0,0,0,0,0,0,0,0,0],offset:0,speed:2,colors:[0,4285020998,4281474590]},{layout:[4,4,5,4,4,4,5,4,3,3],offset:2.5,speed:2,colors:[4281015067,0,0]},{layout:[5,5,4,4,4,4,5,4,4,4],offset:3,speed:3,colors:[4281147166,4281352336,0]},{layout:[5,5,5,5,5,5,5,5,5,5],offset:3.5,speed:3.5,colors:[4281345058,4283457696,0]},{layout:[5,5,5,5,5,5,5,5,5,5],offset:4,speed:4,colors:[4281739300,4286619888,0]}]}];const L=function(t){return n=void 0,o=void 0,u=function(){var n,o,a,u,l,f,h,p,d,y,w,j,L,M,_,V,D,F,N,K,U,H,J,Y,z,G,X,Q,W,q,Z,$;return function(t,e){var n,r,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(s){return function(c){return function(s){if(n)throw new TypeError("Generator is already executing.");for(;i&&(i=0,s[0]&&(a=0)),a;)try{if(n=1,r&&(o=2&s[0]?r.return:s[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,s[1])).done)return o;switch(r=0,o&&(s=[2&s[0],o.value]),s[0]){case 0:case 1:o=s;break;case 4:return a.label++,{value:s[1],done:!1};case 5:a.label++,r=s[1],s=[0];continue;case 7:s=a.ops.pop(),a.trys.pop();continue;default:if(!((o=(o=a.trys).length>0&&o[o.length-1])||6!==s[0]&&2!==s[0])){a=0;continue}if(3===s[0]&&(!o||s[1]>o[0]&&s[1]<o[3])){a.label=s[1];break}if(6===s[0]&&a.label<o[1]){a.label=o[1],o=s;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(s);break}o[2]&&a.ops.pop(),a.trys.pop();continue}s=e.call(t,a)}catch(t){s=[6,t],r=0}finally{n=o=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,c])}}}(this,(function(tt){switch(tt.label){case 0:return n=t.width,o=t.height,a=t.actions,u=t.screen,l=t.fps,f=u.getContext("2d"),h=f.getImageData(0,0,n,o),p=i.from(h.data.buffer,n,o),[4,c.loadImagesAsTileableBitmaps(["../assets/player.png",16,16,4,1],["../assets/backgrounds_houses.png",48,32,5,1],["../assets/backgrounds.png",32,32,6,1])];case 1:return d=tt.sent(),y=d[0],w=d[1],j=d[2],L=y.split().concat(y.flipV().split()),M=[w.reorder([1,0,2,2,0,1],2,3),w.reorder([2,2,1,1,1,1],2,3),w.reorder([3,4,3,1,2,2],2,3),w.reorder([2,2,2,2,0,0,0,0],4,2),w.reorder([1,2,3,1,0,2,2,0],4,2),w.reorder([3,4,1,4,1,3,2,4],4,2),w.reorder([1,1,1,1],2,2),w.reorder([3,2,1,1],2,2),w.reorder([1,2,2,1,1,2,2,1,0,2,2,0],4,3),w.reorder([2,0,1,4,2,0,1,1,0,0,0,0],4,3),w.reorder([1,1,1,1,2,2,3,3],2,4),w.reorder([2,4,3,1,2,2,1,3,0,2,0,0,3,0,0],5,3),w.reorder([0],1,1)],_=[4279242768,4281348144,0],M.map((function(t){return new s(t)})).forEach((function(t){return t.colors=_})),V=new C({width:n,height:o,gravity:.5,friction:.75,skyColor:4288712832}),F=R.map((function(t){return new B(V,t,j,w)})),F.forEach((function(t,e){return e>0&&F[e-1].setNext(t)})),F.forEach((function(t,e){return t.onfinish((function(t,n){D=n,console.debug("Switching ".concat(e))}))})),D=F[0],F[F.length-1].onfinish((function(){window.alert("Дякую за увагу! Будьте щасливі!"),$.stop()})),N=new v(e),K=function(t,e){console.debug("SYSYEMS: initialization");var n=t.width,o=t.height;return{sCollideBounds:new m({cPosition:b,cVelocity:x,cShape:P,cPlayer:T},(function(t,e,i){for(var a=e.cPosition.storage,s=a.x,c=a.y,u=e.cVelocity.storage,l=u.vx,f=u.vy,h=e.cShape.storage,p=h.w,d=h.h,g=(e.cPlayer.storage.air,0),y=i;g<y.length;g++){var v=y[g],w=s[v]+p[v],m=c[v]+d[v],b=O(s[v],c[v],w,m,0,0,n,o);if(b!=r.None)switch(b){case r.Bottom:s[v]=32,c[v]=32;break;case r.Left:l[v]=0,s[v]=0;break;case r.Right:l[v]=0,s[v]=n-p[v];break;case r.Top:f[v]=1,c[v]=0}}})),sCollideShapes:new m({cPosition:b,cVelocity:x,cShape:P,cPlayer:T},(function(t,e,n,o){for(var i=e.cPosition.storage,a=i.x,s=i.y,c=e.cVelocity.storage,u=c.vx,l=c.vy,f=e.cShape.storage,h=f.w,p=f.h,d=e.cPlayer.storage.air,g=0,y=n;g<y.length;g++)for(var v=y[g],w=a[v]+h[v],m=s[v]+p[v],b=0,x=0,P=o;x<P.length;x++){var S=P[x];if(b>2)break;var I=a[S]+h[S],k=s[S]+p[S],A=E(a[v],s[v],w,m,a[S],s[S],I,k);if(A!==r.None)switch(b++,A){case r.Bottom:l[v]=0,s[v]=s[S]-p[v],d[v]=!1;break;case r.Right:u[v]=0,a[v]=a[S]-h[v]-.01;break;case r.Left:u[v]=0,a[v]=I+.01;break;case r.Top:l[v]=1,s[v]=k}}})),sMovement:new m({cPosition:b,cVelocity:x,cPlayer:T},(function(e,n,r){for(var o=n.cPosition.storage,i=o.x,a=o.y,s=n.cVelocity.storage,c=s.vx,u=s.vy,l=(n.cPlayer.storage.air,t.friction),f=t.gravity,h=0,p=r;h<p.length;h++){var d=p[h];i[d]+=c[d]*e,a[d]+=u[d]*e,c[d]*=l,u[d]+=f}})),sDrawing:new m({cSprite:S,cPosition:b},(function(t,n,r){for(var o=n.cSprite.storage,i=o.sprites,a=o.spriteIdx,s=o.flipped,c=o.offsetX,u=o.offsetY,l=n.cPosition.storage,f=l.x,h=l.y,p=0,d=r;p<d.length;p++){var g=d[p],y=i[g].length/2,v=s[g]?a[g]+y:a[g];e.draw(i[g][v],Math.round(c[g]+f[g]),Math.round(u[g]+h[g]))}})),sAnimation:new m({cAnimation:I,cSprite:S},(function(t,e,n){for(var r=e.cAnimation.storage,o=r.animations,i=r.current,a=r.length,s=r.time,c=r.coef,u=e.cSprite.storage.spriteIdx,l=0,f=n;l<f.length;l++){var h=f[l],p=(s[h]+t*c[h])%a[h];u[h]=o[h][i[h]][0|p],s[h]=p}})),sController:new m({cVelocity:x,cInput:k,cSprite:S,cPlayer:T,cAnimation:I},(function(t,e,n){for(var r=e.cSprite.storage.flipped,o=e.cAnimation.storage.current,i=e.cInput.storage.keys,a=e.cVelocity.storage,s=a.vx,c=a.vy,u=e.cPlayer.storage,l=u.air,f=u.speed,h=0,p=n;h<p.length;h++){var d=p[h];i[d].size?(i[d].has("KeyQ")?(s[d]-=f[d],o[d]=1,r[d]=!0):i[d].has("KeyW")&&(s[d]+=f[d],o[d]=1,r[d]=!1),i[d].has("KeyP")&&!l[d]&&(l[d]=!0,c[d]=-10)):o[d]=l[d]?2:0}})),sControllerRunner:new m({cVelocity:x,cInputRunner:A,cPlayer:T,cAnimation:I},(function(t,e,n){for(var r=e.cAnimation.storage,o=r.current,i=r.coef,a=e.cInputRunner.storage,s=a.actions,c=a.jumping,u=e.cVelocity.storage,l=u.vx,f=u.vy,h=e.cPlayer.storage,p=h.air,d=h.speed,g=h.power,y=0,v=n;y<v.length;y++){var w=v[y];s[w].size?(s[w].has("Jump")?c[w]||p[w]||(c[w]=!0,p[w]=!0,f[w]=-g[w]):0==p[w]&&(c[w]=!1),s[w].has("Left")?(l[w]-=d[w],i[w]=.12,o[w]=1):s[w].has("Right")&&(l[w]+=d[w],i[w]=.48,o[w]=1)):(o[w]=p[w]?2:1,i[w]=.24,0==p[w]&&(c[w]=!1))}})),sBuildingsRunner:new m({cPosition:b,cShape:P},(function(t,e,r){for(var o=e.cPosition.storage,i=o.x,a=(o.y,e.cShape.storage),s=a.w,c=(a.h,0),u=r;c<u.length;c++){var l=u[c];i[l]-=1.5*t,i[l]>=-s[l]||(i[l]+=n+s[l])}}))}}(V,p),U=N.add({cPosition:{x:32,y:64},cVelocity:{vx:0,vy:0},cShape:{w:10,h:14},cPlayer:{air:!0,speed:.8,power:6},cInputRunner:{actions:a,jumping:!1,acceleration:0},cSprite:{spriteIdx:0,sprites:L,offsetX:-3,offsetY:-2},cAnimation:{animations:[[0,0,3,3],[1,2,3,0],[1,1,2,2]],current:0,length:4,time:0,coef:.4}}),J=[(H=function(t,e,n){return N.add({cPosition:{x:16*e,y:20*n},cSprite:{spriteIdx:t,sprites:M},cShape:{w:M[t].width,h:M[t].height}})})(0,0,5),H(6,8,6),H(1,16,5),H(2,24,6),H(1,32,6),H(0,40,7),H(7,48,5)],Y=K.sCollideBounds.setup([U]),z=K.sCollideShapes.setup([U],J),G=K.sBuildingsRunner.setup(J),X=K.sMovement.setup([U]),Q=K.sDrawing.setup(function(t,e,n){if(n||2===arguments.length)for(var r,o=0,i=e.length;o<i;o++)!r&&o in e||(r||(r=Array.prototype.slice.call(e,0,o)),r[o]=e[o]);return t.concat(r||Array.prototype.slice.call(e))}([U],J,!0)),W=K.sControllerRunner.setup([U]),q=K.sAnimation.setup([U]),(Z=b.storage).x,Z.y,[2,{engine:$=new g(l,(function(t,e){D.update(t),G(t),X(t),Y(t),z(t),W(t)}),(function(t,e){D.renderBg(t,p),q(t),Q(t),f.putImageData(h,0,0)}),.06)}]}}))},new((a=void 0)||(a=Promise))((function(t,e){function r(t){try{s(u.next(t))}catch(t){e(t)}}function i(t){try{s(u.throw(t))}catch(t){e(t)}}function s(e){var n;e.done?t(e.value):(n=e.value,n instanceof a?n:new a((function(t){t(n)}))).then(r,i)}s((u=u.apply(n,o||[])).next())}));var n,o,a,u};var M={};window.addEventListener("load",(function(){return t=void 0,e=void 0,r=function(){var t,e,n,r,o,i,a,s,c;return function(t,e){var n,r,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(s){return function(c){return function(s){if(n)throw new TypeError("Generator is already executing.");for(;i&&(i=0,s[0]&&(a=0)),a;)try{if(n=1,r&&(o=2&s[0]?r.return:s[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,s[1])).done)return o;switch(r=0,o&&(s=[2&s[0],o.value]),s[0]){case 0:case 1:o=s;break;case 4:return a.label++,{value:s[1],done:!1};case 5:a.label++,r=s[1],s=[0];continue;case 7:s=a.ops.pop(),a.trys.pop();continue;default:if(!((o=(o=a.trys).length>0&&o[o.length-1])||6!==s[0]&&2!==s[0])){a=0;continue}if(3===s[0]&&(!o||s[1]>o[0]&&s[1]<o[3])){a.label=s[1];break}if(6===s[0]&&a.label<o[1]){a.label=o[1],o=s;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(s);break}o[2]&&a.ops.pop(),a.trys.pop();continue}s=e.call(t,a)}catch(t){s=[6,t],r=0}finally{n=o=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,c])}}}(this,(function(u){switch(u.label){case 0:for(t=document.getElementById("debug"),M.set=function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];return t.innerHTML=e.join(", ")},M.add=function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];return t.innerHTML+="<br>"+e.join(", ")},console.log(document),e=document.getElementById("screen"),(n=document.getElementById("overlay")).set=function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];return t.innerHTML=e.join("<br>")},n.add=function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];return t.innerHTML+=e.join("<br>")},r=[document.getElementById("btn-left"),document.getElementById("btn-right"),document.getElementById("btn-jump")],e.width=320,e.height=160,o=new Set,i={KeyQ:"Left",KeyW:"Right",KeyP:"Jump",KeyA:"Left",KeyD:"Right",Space:"Jump",ArrowLeft:"Left",ArrowRight:"Right",ArrowUp:"Jump","btn-left":"Left","btn-right":"Right","btn-jump":"Jump"},window.addEventListener("keydown",(function(t){var e=t.code;return i[e]&&o.add(i[e])})),window.addEventListener("keyup",(function(t){var e=t.code;return i[e]&&o.delete(i[e])})),a=0,s=r;a<s.length;a++)(c=s[a]).addEventListener("touchstart",(function(t){var e=t.target.id;return i[e]&&o.add(i[e])})),c.addEventListener("touchend",(function(t){var e=t.target.id;return i[e]&&o.delete(i[e])})),c.addEventListener("mousedown",(function(t){var e=t.target.id;return i[e]&&o.add(i[e])})),c.addEventListener("mouseup",(function(t){var e=t.target.id;return i[e]&&o.delete(i[e])}));return[4,L({screen:e,overlay:n,width:320,height:160,actions:o,fps:1e3/60})];case 1:return u.sent().engine.start(),console.log("INITIALIZED"),[2]}}))},new((n=void 0)||(n=Promise))((function(o,i){function a(t){try{c(r.next(t))}catch(t){i(t)}}function s(t){try{c(r.throw(t))}catch(t){i(t)}}function c(t){var e;t.done?o(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(a,s)}c((r=r.apply(t,e||[])).next())}));var t,e,n,r}))})();
//# sourceMappingURL=main.js.map